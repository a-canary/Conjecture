[tool:pytest]
# Test discovery configuration
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Default pytest options
addopts =
    -v
    --tb=short
    --strict-markers
    --color=yes
    --durations=10
    --cov=src
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-report=xml:coverage.xml
    --cov-report=json:coverage.json
    --cov-config=.coveragerc
    --maxfail=5
    --timeout=300

# Test markers for comprehensive test categorization
markers =
    # Static analysis markers
    static_analysis: Marks tests that run static analysis tools (ruff, mypy, vulture, bandit)
    ruff: Marks tests that run ruff linting and formatting checks
    mypy: Marks tests that run mypy type checking
    vulture: Marks tests that run vulture dead code detection
    bandit: Marks tests that run bandit security analysis
    
    # Test type markers
    unit: Marks unit tests (isolated, fast, no external dependencies)
    integration: Marks integration tests (multiple components, external services)
    performance: Marks performance tests (benchmarks, load testing)
    slow: Marks slow-running tests (deselect with '-m "not slow"')
    
    # Test characteristic markers
    asyncio: Marks async tests that require asyncio event loop
    critical: Marks tests critical for CI/CD pipeline
    flaky: Marks tests known to be flaky (may need retries)
    smoke: Marks smoke tests for basic functionality verification
    
    # Component-specific markers
    data_layer: Marks tests for data layer components
    process_layer: Marks tests for process layer components
    endpoint_layer: Marks tests for endpoint layer components
    cli_layer: Marks tests for CLI layer components
    
    # Database and storage markers
    sqlite: Marks tests requiring SQLite database
    chroma: Marks tests requiring ChromaDB vector storage
    database: Marks tests requiring any database backend
    
    # External service markers
    llm: Marks tests requiring LLM providers
    embedding: Marks tests requiring embedding services
    network: Marks tests requiring network access
    
    # Security and compliance markers
    security: Marks security-focused tests
    compliance: Marks compliance and regulatory tests
    utf8: Marks tests for UTF-8 encoding compliance
    
    # Development workflow markers
    development: Marks tests for development tools and workflows
    documentation: Marks tests for documentation validation
    examples: Marks tests for example code validation

# Static analysis tool configuration
[pytest-static-analysis]
# Enable auto-discovery of static analysis tools
auto_discovery = true

# Tool-specific configurations
[ruff]
enabled = true
config_file = .ruff.toml
fail_on_error = false
integration_marker = ruff

[mypy]
enabled = true
config_file = mypy.ini
fail_on_error = false
integration_marker = mypy

[vulture]
enabled = true
config_file = vulture.cfg
fail_on_error = false
integration_marker = vulture
min_confidence = 80

[bandit]
enabled = true
config_file = .bandit
fail_on_error = false
integration_marker = bandit

# Performance and optimization settings
[pytest-performance]
parallel_execution = true
parallel_workers = auto
test_randomization = true
memory_monitoring = true
performance_timing = true

# Reporting and output settings
[pytest-reporting]
generate_html_report = true
generate_json_report = true
generate_xml_report = true
include_performance_metrics = true
include_coverage_metrics = true
include_static_analysis_metrics = true

# Warning filters
filterwarnings =
    ignore::UserWarning
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning